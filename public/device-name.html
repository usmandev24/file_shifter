<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/public/styles/main_styles.css" />
    <title>Home</title>
  </head>
  <body>
    <div
      class="flex flex-1 justify-between items-center-safe md:ml-12 md:mr-12 mb-2 border rounded-lg border-base-300 m-auto shadow-md"
    >
      <div class="w-[4rem]"></div>
      <h1 class="text-xl lg:text-2xl p-2 ml-2 font-bold">
        <a href="/">File Shifter</a>
      </h1>

      <div class="dropdown dropdown-end dropdown-bottom">
        <div
          role="button"
          tabindex="0"
          class="btn btn-md lg:btn-lg btn-dash btn-ghost p-1 md:p-2 font-bold mr-2"
        >
          QR Code
        </div>
        <ul
          class="dropdown-content bg-base-100 border border-gray-500 rounded-lg  w-48 z-10 p-2 m-4 mr-3"
        >
          <img src="/public/images/qrcode.svg" />
        </ul>
      </div>
    </div>
    <div
      class="flex h-[calc(100vh-4rem)] flex-col pl-2 pr-2 md:pl-12 md:pr-12 items-center-safe justify-center-safe"
    >
      <div class="card  md:card:md lg:card-lg xl:card:xl bg-base-300">
        <div class="card-body items-center p-4 md:p-8">
          <h2 class="card-title text-xl mt-3">Send and Recieve Files</h2>
          <p
            class="mt-2 text-lg text-[1rem] text-center alert alert-info alert-soft"
          >
            Transfer files seamlessly between your devices over the same üåê
            Wi-Fi network, or through a mobile hotspot connection (e.g.,üíªPC
            connected to your üì±phone‚Äôs hotspot).
          </p>
          <h2 class="text-lg font-bold mt-4">Set Devcie Name first</h2>
          <div class="mt-3">
            Enter a Uniqe Device Name 
            <div class="dropdown dropdown-end md:dropdown-center">
              <div tabindex="0" role="button" class="text-[0.8rem] pl-2 ">
                ‚ùî
              </div>
              <div  class="dropdown-content z-10 w-40 md:w-60 bg-base-100  p-2 shadow-2xl rounded-lg">
                <p class="text-sm ">‚ìò <span class="font-bold">Every device should have diffrent name.</span><br> Like Usman's LapTop, Ali's iPhone 15 or Nokia 5+ etc.</p>
              </div>
            </div>
          </div>
          <div
            class="flex flex-col justify-center-safe items-center-safe gap-3 mt-3"
          >
            <label class="input input-primary">
              Device Name:
              <input type="text" id="input"  />
            </label>
            <p class="info" id="info"></p>
            <button class="btn btn-primary btn-md w-20 md:btn-md lg:btn:lg" id="btn">Ok</button>
          </div>
        </div>
      </div>
    </div>
    <script>
      const input = document.getElementById("input");
      const info = document.getElementById("info");
      const btn = document.getElementById("btn")

      async function fetchV(value="") {
        value = value.replace(/&/ig, "-")
        const req = await fetch("/set-device-name", {
          method: "GET", 
          headers: {
            "devicename": value
          }
        });
        const res = await req.text();
        console.log(res)
        if (res === "done") {
          return true 
        } else false;
      }
      btn.onclick = async (event) => {
        const r = await fetchV(input.value);
        if (r) {
          info.textContent = "‚úÖ Device Name :  "+input.value ;
          btn.disabled = true;
          let home= document.createElement("a");
          home.href = "/";
          setTimeout(() => {
            home.click()
          }, 1000);
          localStorage.setItem("deviceName", input.value)
        } 
        else {
          input.value = "";
          info.textContent = "‚ö†Ô∏è Already a device has this name, Enter again.";
        }
      }

    </script>
  </body>
</html>
